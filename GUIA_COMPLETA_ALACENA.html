<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§º ALACENA - GuÃ­a Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        h2 {
            color: #2980b9;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #f9f9f9;
        }

        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background-color: #f0f0f0;
        }

        code {
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #c0392b;
        }

        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        pre code {
            background-color: transparent;
            color: #ecf0f1;
            padding: 0;
        }

        .box {
            background-color: #ecf0f1;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .box.warning {
            background-color: #fef5e7;
            border-left-color: #f39c12;
        }

        .box.success {
            background-color: #eafaf1;
            border-left-color: #27ae60;
        }

        .box.error {
            background-color: #fadbd8;
            border-left-color: #e74c3c;
        }

        ul,
        ol {
            margin: 15px 0;
            margin-left: 30px;
        }

        li {
            margin-bottom: 10px;
        }

        .flow {
            background-color: #f9f9f9;
            border: 2px solid #3498db;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .toc {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .toc h3 {
            margin-top: 0;
        }

        .toc ul {
            margin-left: 20px;
        }

        .toc a {
            color: #2980b9;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        @media print {
            body {
                background-color: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .no-print {
                display: none;
            }
        }

        .print-only {
            display: none;
        }

        @media print {
            .print-only {
                display: block;
            }
        }

        .emoji {
            font-size: 1.2em;
        }

        hr {
            border: none;
            border-top: 2px solid #ecf0f1;
            margin: 40px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ§º ALACENA - GuÃ­a Completa de Arquitectura y CÃ³digo</h1>
        <p class="subtitle"><strong>Ãšltima ActualizaciÃ³n:</strong> 23 de enero de 2026 | <strong>VersiÃ³n:</strong> 1.0
        </p>

        <div class="box">
            <strong>ğŸ’¡ GuÃ­a educativa para entender el proyecto desde cero.</strong><br>
            Lee este documento para comprender la arquitectura, los lenguajes y cÃ³mo funciona cada componente.
        </div>

        <h2>ğŸ“‹ Tabla de Contenidos</h2>
        <div class="toc">
            <ul>
                <li><a href="#que-es">Â¿QUÃ‰ ES ALACENA?</a></li>
                <li><a href="#tecnologias">TecnologÃ­as Utilizadas</a></li>
                <li><a href="#flujo-sesion">Flujo de una SesiÃ³n TÃ­pica</a></li>
                <li><a href="#estructura">Estructura de Carpetas</a></li>
                <li><a href="#modelos">Modelos de Base de Datos</a></li>
                <li><a href="#flujo-api">Flujo de una PeticiÃ³n API</a></li>
                <li><a href="#jwt">AutenticaciÃ³n - JWT</a></li>
                <li><a href="#lenguajes">Lenguajes Explicados</a></li>
                <li><a href="#componentes">Componentes Clave</a></li>
                <li><a href="#troubleshooting">Solucionar Problemas</a></li>
            </ul>
        </div>

        <hr>

        <h2 id="que-es">Â¿QUÃ‰ ES ALACENA?</h2>
        <p>ALACENA es un <strong>sistema full-stack</strong> (frontend + backend + base de datos) para gestionar un
            inventario de cocina. Es como un "ERP ligero" pero para tu cocina personal.</p>

        <h3>PropÃ³sito:</h3>
        <ul>
            <li>Guardar quÃ© ingredientes tienes y dÃ³nde estÃ¡n</li>
            <li>Registrar recetas que hiciste</li>
            <li>Gestionar reservas/porciones de comida</li>
            <li>Ver un menÃº pÃºblico con lo que hay disponible</li>
        </ul>

        <h3>Componentes principales:</h3>
        <ul>
            <li><strong>ğŸ–¥ï¸ Frontend:</strong> Interfaz visual (lo que ves en pantalla)</li>
            <li><strong>âš™ï¸ Backend:</strong> LÃ³gica del negocio (procesa datos, autenticaciÃ³n)</li>
            <li><strong>ğŸ—„ï¸ Base de datos:</strong> Guarda toda la informaciÃ³n persistentemente</li>
        </ul>

        <hr>

        <h2 id="tecnologias">TecnologÃ­as Utilizadas</h2>

        <h3>Frontend (c:\Users\Usuario\alacena\frontend\alacena-app)</h3>
        <table>
            <tr>
                <th>TecnologÃ­a</th>
                <th>Tipo</th>
                <th>Â¿QuÃ© es?</th>
                <th>Â¿Para quÃ©?</th>
            </tr>
            <tr>
                <td><strong>Next.js 15</strong></td>
                <td>Framework</td>
                <td>Basado en React</td>
                <td>Crea aplicaciones web modernas con SSR</td>
            </tr>
            <tr>
                <td><strong>React 18</strong></td>
                <td>LibrerÃ­a UI</td>
                <td>Componentes visuales</td>
                <td>Crea componentes interactivos reutilizables</td>
            </tr>
            <tr>
                <td><strong>TypeScript</strong></td>
                <td>Lenguaje</td>
                <td>JavaScript con tipos</td>
                <td>AÃ±ade seguridad de tipos al cÃ³digo</td>
            </tr>
            <tr>
                <td><strong>Tailwind CSS</strong></td>
                <td>Framework CSS</td>
                <td>Utilidades de estilos</td>
                <td>Crea interfaces bonitas sin CSS manual</td>
            </tr>
            <tr>
                <td><strong>NextAuth v5</strong></td>
                <td>LibrerÃ­a Auth</td>
                <td>AutenticaciÃ³n</td>
                <td>Gestiona login/logout/sesiones seguro</td>
            </tr>
            <tr>
                <td><strong>Zod</strong></td>
                <td>LibrerÃ­a ValidaciÃ³n</td>
                <td>Schema validation</td>
                <td>Valida que los datos sean del tipo correcto</td>
            </tr>
            <tr>
                <td><strong>Axios</strong></td>
                <td>LibrerÃ­a HTTP</td>
                <td>Cliente HTTP</td>
                <td>Hace peticiones al backend</td>
            </tr>
        </table>

        <p><strong>Lenguaje:</strong> TypeScript/JavaScript (TSX - TypeScript + JSX)</p>

        <h3>Backend (c:\Users\Usuario\alacena\backend)</h3>
        <table>
            <tr>
                <th>TecnologÃ­a</th>
                <th>Tipo</th>
                <th>Â¿QuÃ© es?</th>
                <th>Â¿Para quÃ©?</th>
            </tr>
            <tr>
                <td><strong>Express.js</strong></td>
                <td>Framework</td>
                <td>Framework web</td>
                <td>Crea un servidor HTTP con rutas</td>
            </tr>
            <tr>
                <td><strong>Node.js</strong></td>
                <td>Runtime</td>
                <td>Entorno de ejecuciÃ³n</td>
                <td>Ejecuta JavaScript en el servidor</td>
            </tr>
            <tr>
                <td><strong>Prisma</strong></td>
                <td>ORM</td>
                <td>Object-Relational Mapping</td>
                <td>InteractÃºa con la BD de forma segura</td>
            </tr>
            <tr>
                <td><strong>PostgreSQL</strong></td>
                <td>Base de datos</td>
                <td>SQL relacional</td>
                <td>Almacena todos los datos</td>
            </tr>
            <tr>
                <td><strong>JWT</strong></td>
                <td>LibrerÃ­a Tokens</td>
                <td>JSON Web Tokens</td>
                <td>Crea tokens para verificar autenticaciÃ³n</td>
            </tr>
            <tr>
                <td><strong>bcryptjs</strong></td>
                <td>LibrerÃ­a Hash</td>
                <td>Password hashing</td>
                <td>Guarda contraseÃ±as de forma segura</td>
            </tr>
        </table>

        <p><strong>Lenguaje:</strong> JavaScript (Node.js)</p>

        <hr>

        <h2 id="flujo-sesion">Flujo de una SesiÃ³n TÃ­pica</h2>

        <h3>Escenario: Usuario intenta loguear</h3>

        <div class="flow">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 1: Usuario entra a http://localhost:3000 â”‚
            â”‚ âœ“ Frontend carga la pÃ¡gina â”‚
            â”‚ âœ“ Middleware revisa: Â¿hay sesiÃ³n? â”‚
            â”‚ âœ— NO hay sesiÃ³n â†’ redirige a /login â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 2: Usuario ve FORMULARIO DE LOGIN â”‚
            â”‚ âœ“ PÃ¡gina renderizada con campos: â”‚
            â”‚ - Email: [ ] â”‚
            â”‚ - ContraseÃ±a: [ ] â”‚
            â”‚ - [Ingresar] â”‚
            â”‚ â”‚
            â”‚ Usuario ingresa: â”‚
            â”‚ - Email: admin@alacena.com â”‚
            â”‚ - ContraseÃ±a: admin123 â”‚
            â”‚ - Hace click en "Ingresar" â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 3: FRONTEND (NextAuth) interpreta el submit â”‚
            â”‚ âœ“ handleSubmit() se ejecuta â”‚
            â”‚ âœ“ Llama a: signIn('credentials', {...}) â”‚
            â”‚ âœ“ NextAuth intercepta y usa CredentialsProvider â”‚
            â”‚ âœ“ Llama authorize() definido en auth.ts â”‚
            â”‚ âœ“ authorize() hace fetch a backend: POST /api/auth/login
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 4: BACKEND recibe POST /api/auth/login â”‚
            â”‚ âœ“ Express recibe peticiÃ³n â”‚
            â”‚ âœ“ auth.controller.login() se ejecuta: â”‚
            â”‚ 1. Lee email y password del request â”‚
            â”‚ 2. Busca usuario en BD â”‚
            â”‚ 3. Compara password con bcrypt.compare() â”‚
            â”‚ 4. Si NO coincide â†’ error 401 â”‚
            â”‚ 5. Si coincide â†’ genera JWT â”‚
            â”‚ 6. Retorna: { user: {id, email, name}, token } â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 5: FRONTEND recibe la respuesta â”‚
            â”‚ âœ“ authorize() retorna el usuario con el token â”‚
            â”‚ âœ“ NextAuth ejecuta callbacks: â”‚
            â”‚ 1. jwt() â†’ guarda datos en JWT â”‚
            â”‚ 2. session() â†’ aÃ±ade datos a la sesiÃ³n â”‚
            â”‚ âœ“ NextAuth crea COOKIE SEGURA con JWT encriptado â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PASO 6: Usuario redirigido a /dashboard â”‚
            â”‚ âœ“ signIn() termina correctamente â”‚
            â”‚ âœ“ router.push('/dashboard') â”‚
            â”‚ âœ“ Middleware revisa: Â¿hay sesiÃ³n? â”‚
            â”‚ âœ“ SÃ hay sesiÃ³n â†’ permite acceso â”‚
            â”‚ âœ“ Dashboard se carga con datos del usuario â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

        <hr>

        <h2 id="estructura">Estructura de Carpetas</h2>

        <h3>Frontend</h3>
        <pre><code>frontend/alacena-app/
â”œâ”€â”€ app/                                    # Carpeta de rutas (Next.js)
â”‚   â”œâ”€â”€ page.tsx                           # PÃ¡gina raÃ­z (/)
â”‚   â”œâ”€â”€ layout.tsx                         # HTML comÃºn para todas
â”‚   â”œâ”€â”€ login/page.tsx                     # Formulario de login
â”‚   â”œâ”€â”€ dashboard/                         # Protegida por middleware
â”‚   â”‚   â”œâ”€â”€ page.tsx                       # Home del dashboard
â”‚   â”‚   â”œâ”€â”€ layout.tsx                     # Sidebar
â”‚   â”‚   â”œâ”€â”€ items/page.tsx                 # CRUD de items
â”‚   â”‚   â”œâ”€â”€ locations/page.tsx             # CRUD de ubicaciones
â”‚   â”‚   â”œâ”€â”€ reserves/page.tsx              # CRUD de reservas
â”‚   â”‚   â””â”€â”€ menu/page.tsx                  # CRUD del menÃº
â”‚   â”œâ”€â”€ guest/menu/page.tsx                # MenÃº pÃºblico
â”‚   â””â”€â”€ api/auth/[...nextauth]/route.ts    # Rutas de NextAuth
â”œâ”€â”€ auth.ts                                # Config de NextAuth
â”œâ”€â”€ middleware.ts                          # ProtecciÃ³n de rutas
â”œâ”€â”€ lib/validations.ts                     # Schemas Zod
â””â”€â”€ .env.local                             # Variables de entorno

Backend

frontend/alacena-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js                             # ConfiguraciÃ³n de Express
â”‚   â”‚                                      # - CORS habilitado
â”‚   â”‚                                      # - JSON parser
â”‚   â”‚                                      # - Rutas registradas
â”‚   â”‚
â”‚   â”œâ”€â”€ server.js                          # Punto de entrada
â”‚   â”‚                                      # - Inicia servidor en 3001
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/                       # LÃ³gica de negocio
â”‚   â”‚   â”œâ”€â”€ auth.controller.js             # register/login/getProfile
â”‚   â”‚   â”œâ”€â”€ item.controller.js             # Maneja Items
â”‚   â”‚   â”œâ”€â”€ location.controller.js         # Maneja Locations
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                            # Rutas HTTP
â”‚   â”‚   â”œâ”€â”€ auth.routes.js                 # GET/POST /api/auth/*
â”‚   â”‚   â”œâ”€â”€ items.routes.js                # GET/POST/PUT/DELETE
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                           # ValidaciÃ³n (Zod)
â”‚   â”‚   â”œâ”€â”€ item.schema.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ prisma/
â”‚       â””â”€â”€ client.js                      # Singleton de Prisma
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma                      # DEFINICIÃ“N DE MODELOS
â”‚   â”œâ”€â”€ seed.js                            # Datos de prueba
â”‚   â””â”€â”€ migrations/                        # HistÃ³rico de cambios
â”‚
â”œâ”€â”€ .env                                   # Variables de entorno
â””â”€â”€ package.json                           # Dependencias</code></pre>

        <hr>

        <h2 id="modelos">Modelos de Base de Datos</h2>

        <h3>Modelo: User (Usuario)</h3>
        <pre><code>model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  passwordHash  String
  role          String    @default("user")
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}</code></pre>

        <h3>Modelo: Item (Ingrediente/Producto)</h3>
        <pre><code>model Item {
  id          String   @id @default(cuid())
  code        String?  @unique
  name        String
  kind        ItemKind  // PRODUCT o RECIPE
}

enum ItemKind {
  PRODUCT   // Ingredientes, bebidas
  RECIPE    // Preparaciones, recetas
}</code></pre>

        <h3>Modelo: Location (UbicaciÃ³n)</h3>
        <pre><code>model Location {
  id          String       @id @default(cuid())
  code        String?      @unique
  name        String
  kind        LocationKind  // AREA, SECTION, SLOT
  parentId    String?
  parent      Location?    @relation("LocationTree")
  children    Location[]   @relation("LocationTree")
  sortIndex   Int          @default(0)
}

enum LocationKind {
  AREA      // Freezer, Heladera
  SECTION   // CajÃ³n, Estante
  SLOT      // PosiciÃ³n
}</code></pre>

        <h3>Modelo: Reserve (Reserva/PorciÃ³n)</h3>
        <pre><code>model Reserve {
  id            String   @id @default(cuid())
  itemId        String
  item          Item     @relation(fields: [itemId])
  locationId    String
  location      Location @relation(fields: [locationId])
  containerId   String
  container     Container @relation(fields: [containerId])
  status        ReserveStatus
  quantity      Float?
  unit          UnitKind
}

enum ReserveStatus {
  ACTIVE        // En inventario
  TRANSFORMED   // Transformada
  CONSUMED      // Consumida
  DISCARDED     // Descartada
}</code></pre>

        <hr>

        <h2 id="flujo-api">Flujo de una PeticiÃ³n API</h2>

        <h3>Ejemplo: Crear un nuevo item</h3>

        <h4>1. Frontend hace la peticiÃ³n (app/dashboard/items/page.tsx)</h4>
        <pre><code>const formData = {
  name: "Lentejas",
  code: "LENT-CH",
  kind: "PRODUCT"
}

const response = await fetch('http://localhost:3001/api/items', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${session.backendToken}`
  },
  body: JSON.stringify(formData)
})</code></pre>

        <h4>2. Backend recibe y procesa (src/controllers/item.controller.js)</h4>
        <pre><code>async function create(req, res) {
  try {
    const { name, code, kind } = req.body
    
    if (!name) {
      return res.status(400).json({ error: 'Name requerido' })
    }

    const item = await prisma.item.create({
      data: { name, code, kind }
    })

    res.status(201).json({ success: true, item })
  } catch (error) {
    res.status(500).json({ error: error.message })
  }
}</code></pre>

        <h4>3. Base de datos ejecuta SQL</h4>
        <pre><code>INSERT INTO Item (id, name, code, kind, createdAt, updatedAt)
VALUES ('cuid-123', 'Lentejas', 'LENT-CH', 'PRODUCT', NOW(), NOW())</code></pre>

        <h4>4. Frontend recibe respuesta</h4>
        <pre><code>if (response.ok) {
  const { item } = await response.json()
  setItems([...items, item])
  setMessage('Item creado âœ“')
}</code></pre>

        <hr>

        <h2 id="jwt">AutenticaciÃ³n - JWT</h2>

        <h3>Â¿QuÃ© es un JWT?</h3>
        <p>Un <strong>JWT (JSON Web Token)</strong> es un "carnet de identidad digital" que el backend firma y da al
            cliente.</p>

        <h3>Estructura de un JWT</h3>
        <pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
.eyJ1c2VySWQiOiIxMjMiLCJlbWFpbCI6ImFkbWluQGFsYWNlbmEuY29tIn0
.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXo

Decodificado:

HEADER: { "alg": "HS256", "typ": "JWT" }
PAYLOAD: { "userId": "123", "email": "admin@alacena.com" }
SIGNATURE: HMACSHA256(header + payload, JWT_SECRET)</code></pre>

        <h3>Flujo de autenticaciÃ³n</h3>
        <div class="flow">1. LOGIN
            Usuario envÃ­a email/password
            â†’ POST /api/auth/login

            2. BACKEND VERIFICA
            Compara password con bcrypt.compare()
            Si correcto â†’ jwt.sign({ userId, email }, JWT_SECRET)

            3. RETORNA JWT
            { user: {...}, token: "JWT..." }

            4. CLIENTE GUARDA
            NextAuth guarda JWT en cookie encriptada

            5. PETICIONES SUBSECUENTES
            Authorization: Bearer JWT...
            â†’ Backend verifica JWT
            â†’ Si vÃ¡lido â†’ procesa peticiÃ³n
            â†’ Si invÃ¡lido â†’ 401 Unauthorized

            6. TOKEN EXPIRA
            DespuÃ©s de 30 dÃ­as â†’ Usuario debe loguear nuevamente</div>

        <h3>ContraseÃ±as: bcrypt</h3>
        <p>Las contraseÃ±as NUNCA se guardan en texto plano:</p>
        <pre><code>// Registro
const password = "admin123"
const passwordHash = await bcrypt.hash(password, 10)
// passwordHash = "$2a$10$GHX8.yL9OJ1CpQs3f6J3He..."

// Login
const isValid = await bcrypt.compare(password, user.passwordHash)
// Retorna true o false</code></pre>

        <hr>

        <h2 id="lenguajes">Lenguajes Explicados</h2>

        <h3>JavaScript (Backend)</h3>
        <p><strong>Â¿QuÃ© es?</strong> Lenguaje de programaciÃ³n que corre en Node.js (servidor).</p>
        <pre><code>// Variables
const nombre = "Juan"
let edad = 30

// Funciones
function saludar(nombre) {
  return `Hola ${nombre}`
}

// Funciones flecha
const sumar = (a, b) => a + b

// Async/await
async function obtenerDatos() {
  try {
    const response = await fetch('http://...')
    const data = await response.json()
    return data
  } catch (error) {
    console.error('Error:', error)
  }
}</code></pre>

        <h3>TypeScript (Frontend)</h3>
        <p><strong>Â¿QuÃ© es?</strong> JavaScript + sistema de tipos. Detecta errores antes de ejecutar.</p>
        <pre><code>// JavaScript: sin tipos (puede fallar)
sumar(5, 3)        // âœ“ 8
sumar("5", "3")    // âœ“ "53" (Â¡INCORRECTO!)

// TypeScript: con tipos (seguro)
function sumar(a: number, b: number): number {
  return a + b
}

sumar(5, 3)        // âœ“ 8
sumar("5", "3")    // âœ— ERROR en desarrollo</code></pre>

        <h3>JSX/TSX (Frontend)</h3>
        <p><strong>Â¿QuÃ© es?</strong> HTML dentro de JavaScript/TypeScript.</p>
        <pre><code>// Componente React
export default function Saludo({ nombre }: { nombre: string }) {
  const [count, setCount] = useState(0)
  
  return (
    &lt;div&gt;
      &lt;h1&gt;Hola, {nombre}!&lt;/h1&gt;
      &lt;p&gt;Contador: {count}&lt;/p&gt;
      &lt;button onClick={() => setCount(count + 1)}&gt;
        Incrementar
      &lt;/button&gt;
    &lt;/div&gt;
  )
}</code></pre>

        <hr>

        <h2 id="componentes">Componentes Clave</h2>

        <h3>NextAuth (AutenticaciÃ³n)</h3>
        <p><strong>Archivo:</strong> auth.ts</p>
        <p><strong>Â¿QuÃ© hace?</strong> Gestiona sesiones, protege rutas, maneja cookies JWT.</p>
        <pre><code>export const { auth, handlers, signIn } = NextAuth({
  secret: process.env.AUTH_SECRET,
  
  providers: [
    CredentialsProvider({
      async authorize(credentials) {
        // Llama a backend para validar
        const res = await fetch(`${API_URL}/api/auth/login`, {
          method: 'POST',
          body: JSON.stringify(credentials)
        })
        
        if (!res.ok) return null
        const user = await res.json()
        return user
      }
    })
  ],
  
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.backendToken = user.token
      }
      return token
    }
  }
})</code></pre>

        <h3>Middleware (ProtecciÃ³n de Rutas)</h3>
        <p><strong>Archivo:</strong> middleware.ts</p>
        <pre><code>export const middleware = auth((req) => {
  // No hay sesiÃ³n â†’ redirige a /login
  if (!req.auth && req.nextUrl.pathname.startsWith('/dashboard')) {
    const loginUrl = new URL('/login', req.nextUrl.origin)
    return Response.redirect(loginUrl)
  }
})</code></pre>

        <h3>Express (Backend)</h3>
        <p><strong>Archivo:</strong> src/app.js</p>
        <pre><code>const express = require('express')
const cors = require('cors')

const app = express()

app.use(cors())
app.use(express.json())

app.get('/health', (req, res) => {
  res.json({ status: 'ok' })
})

app.use('/api/auth', authRoutes)
app.use('/api/items', itemsRoutes)

module.exports = app</code></pre>

        <h3>Prisma (ORM)</h3>
        <p><strong>Â¿QuÃ© es?</strong> Intermediario entre tu cÃ³digo y la base de datos.</p>
        <pre><code>// CREATE
const user = await prisma.user.create({
  data: { email, passwordHash, name }
})

// READ
const user = await prisma.user.findUnique({
  where: { id: "123" }
})

// UPDATE
const updated = await prisma.user.update({
  where: { id: "123" },
  data: { name: "Juan Actualizado" }
})

// DELETE
await prisma.user.delete({
  where: { id: "123" }
})</code></pre>

        <hr>

        <h2 id="troubleshooting">Solucionar Problemas</h2>

        <h3>âŒ "MissingSecret: Please define a secret"</h3>
        <div class="box error">
            <strong>Causa:</strong> Variable AUTH_SECRET no configurada<br>
            <strong>SoluciÃ³n:</strong><br>
            1. Abre frontend/alacena-app/.env.local<br>
            2. AsegÃºrate de tener: AUTH_SECRET=tu-secret<br>
            3. Reinicia frontend: npm run dev
        </div>

        <h3>âŒ "No es posible conectar con el servidor remoto"</h3>
        <div class="box error">
            <strong>Causa:</strong> Frontend no puede acceder al backend<br>
            <strong>SoluciÃ³n:<br>
                1. Abre PowerShell<br>
                2. Ejecuta: curl.exe http://localhost:3001/health<br>
                3. Si falla â†’ Backend no estÃ¡ corriendo<br>
                4. Levanta backend: Set-Location backend; npm run dev
        </div>

        <h3>âŒ "Email o contraseÃ±a incorrectos"</h3>
        <div class="box error">
            <strong>Causa:</strong> Usuario no existe o credenciales incorrectas<br>
            <strong>SoluciÃ³n:</strong><br>
            Ejecuta el seed para crear usuario de prueba:<br>
            <code>cd backend && npm run prisma:seed</code><br>
            Credenciales: admin@alacena.com / admin123
        </div>

        <h3>âŒ Frontend no redirige a login</h3>
        <div class="box error">
            <strong>Causa:</strong> Middleware no se cargÃ³<br>
            <strong>SoluciÃ³n:</strong><br>
            1. DetÃ©n frontend (Ctrl+C)<br>
            2. Elimina: rm -Recurse frontend/alacena-app/.next<br>
            3. Reinicia: npm run dev
        </div>

        <hr>

        <h2>ConclusiÃ³n</h2>
        <div class="box success">
            <strong>ALACENA estÃ¡ construido con:</strong><br><br>
            âœ“ <strong>Frontend moderno:</strong> Next.js + TypeScript + React<br>
            âœ“ <strong>Backend robusto:</strong> Express + Prisma + PostgreSQL<br>
            âœ“ <strong>AutenticaciÃ³n segura:</strong> JWT + bcrypt + NextAuth<br>
            âœ“ <strong>CÃ³digo tipado:</strong> TypeScript para menos errores
        </div>

        <h3>Conceptos clave para dominar:</h3>
        <ol>
            <li><strong>Flujo de login:</strong> Middleware â†’ NextAuth â†’ Backend â†’ JWT</li>
            <li><strong>Peticiones API:</strong> Frontend â†’ Express routes â†’ Controllers â†’ Prisma â†’ BD</li>
            <li><strong>AutenticaciÃ³n:</strong> JWT en cookies + Middleware de protecciÃ³n</li>
            <li><strong>Lenguajes:</strong> JavaScript (backend), TypeScript (frontend), SQL (BD)</li>
        </ol>

        <h3>PrÃ³ximos pasos para aprender:</h3>
        <ol>
            <li>Lee un controlador completamente (ej: auth.controller.js)</li>
            <li>Entiende cÃ³mo se conecta con su ruta (auth.routes.js)</li>
            <li>Revisa cÃ³mo el frontend lo usa (login/page.tsx)</li>
            <li>Modifica algo pequeÃ±o y observa el flujo</li>
        </ol>

        <hr>

        <div class="box success" style="text-align: center; font-size: 1.2em; padding: 30px;">
            <strong>Â¡Mucho Ã©xito en tu aprendizaje! ğŸš€</strong><br><br>
            Ahora tienes la base para entender y debuggear el proyecto por tu cuenta.
        </div>

    </div>
</body>

</html>